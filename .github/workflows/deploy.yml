name: Minificar y Desplegar a Netlify

on:
  push:
    branches:
      - main  # Asegúrate de que tu rama se llame main o cámbialo a master

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Descargar código del repo
        uses: actions/checkout@v3

      - name: Instalar herramientas
        run: |
          npm install -g minify terser

      - name: Preparar y Minificar
        run: |
          mkdir -p dist
          # Copiamos todo el contenido actual a la carpeta dist
          cp -R . dist/ || true
          # Borramos la carpeta .github de la copia para que no se suba a Netlify
          rm -rf dist/.github
          
          # Minificar JS (si existen archivos .js)
          find dist -name "*.js" -exec terser {} -o {} \; || echo "No hay JS"
          
          # Minificar CSS y HTML (si existen)
          find dist -name "*.css" -exec minify {} -o {} \; || echo "No hay CSS"
          find dist -name "*.html" -exec minify {} -o {} \; || echo "No hay HTML"

      - name: Verificación Visual (REVISA ESTO EN EL LOG)
        run: |
          echo "Contenido de la carpeta dist que se enviará a Netlify:"
          ls -R dist

      - name: Desplegar a Netlify
        uses: nwtgck/actions-netlify@v2.0
        with:
          publish-dir: './dist'
          production-deploy: true
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}